<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In â€“ Study Decoder</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #6C63FF 100%);
            color: #2A2A2A;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .signin-container {
            background: #fff;
            padding: 48px 32px 40px 32px;
            border-radius: 24px;
            box-shadow: 0 8px 40px rgba(108,99,255,0.18);
            max-width: 350px;
            width: 90vw;
            text-align: center;
        }
        .signin-container img {
            width: 64px;
            height: 64px;
            margin-bottom: 18px;
        }
        .signin-container h2 {
            font-size: 2rem;
            font-weight: 700;
            color: #4f8cff;
            margin-bottom: 10px;
        }
        .signin-container p {
            font-size: 1.1rem;
            color: #444;
            margin-bottom: 28px;
        }
    </style>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <div class="signin-container">
        <img src="logo.png" alt="Logo">
        <h2>Sign In to Study Decoder</h2>
        <p>Please sign in with your Google account to continue.</p>
        <div id="g_id_onload"
             data-client_id="875851537672-mn188te4kip14c0f6th40o9ui9ccuevs.apps.googleusercontent.com"
             data-callback="handleCredentialResponse"
             data-auto_prompt="false">
        </div>
        <div id="google-signin-btn" style="display:flex;justify-content:center;">
            <div class="g_id_signin"
                 data-type="standard"
                 data-size="large"
                 data-theme="outline"
                 data-text="sign_in_with"
                 data-shape="rectangular"
                 data-logo_alignment="left">
            </div>
        </div>
    </div>
    <script>
    function parseJwt(token) {
        var base64Url = token.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        return JSON.parse(jsonPayload);
    }
    function handleCredentialResponse(response) {
        const user = parseJwt(response.credential);
        const juniorPaid = localStorage.getItem('juniorbot_paid_' + user.sub);
        const seniorPaid = localStorage.getItem('seniorbot_paid_' + user.sub);
        // Remove any previous paywall if present
        const oldPaywall = document.getElementById('paywall-signin');
        if (oldPaywall) oldPaywall.remove();
        if (seniorPaid === 'yes') {
            window.location.href = 'senior-bot.html';
            return;
        } else if (juniorPaid === 'yes') {
            window.location.href = 'junior-bot.html';
            return;
        }
        // Not paid, show Stripe payment options directly on sign-in page
        const paywall = document.createElement('div');
        paywall.id = 'paywall-signin';
        paywall.style = 'background:#fff;padding:32px 24px 28px 24px;border-radius:18px;box-shadow:0 8px 40px rgba(108,99,255,0.12);max-width:340px;width:90vw;text-align:center;margin:32px auto 0;';
        paywall.innerHTML = `
            <img src='logo.png' alt='Logo' style='width:44px;height:44px;margin-bottom:12px;'>
            <h2 style='font-size:1.3rem;font-weight:700;color:#4f8cff;margin-bottom:8px;'>Unlock Study Decoder</h2>
            <p style='font-size:1rem;color:#444;margin-bottom:18px;'>Choose a plan to access all features:</p>
            <a href='https://buy.stripe.com/eVq14masZ0oEbmO1n57Vm00' target='_blank' style='display:block;margin-bottom:12px;background:#6C63FF;color:#fff;font-weight:600;font-size:1rem;padding:10px 0;border-radius:10px;text-decoration:none;'>Monthly Access</a>
            <a href='https://buy.stripe.com/00wdR8dFbfjyaiK3vd7Vm02' target='_blank' style='display:block;margin-bottom:18px;background:#4f8cff;color:#fff;font-weight:600;font-size:1rem;padding:10px 0;border-radius:10px;text-decoration:none;'>Yearly Access</a>
            <div style='font-size:0.95rem;color:#666;margin-bottom:12px;'>After payment, return here and click below:</div>
            <button onclick="localStorage.setItem('seniorbot_paid_' + '${user.sub}','yes');window.location.href='senior-bot.html';" style='background:#6C63FF;color:#fff;font-weight:600;font-size:1rem;padding:10px 0;width:100%;border:none;border-radius:8px;cursor:pointer;'>I've paid, let me in!</button>
        `;
        document.querySelector('.signin-container').appendChild(paywall);
    }
    </script>
</body>
</html>
